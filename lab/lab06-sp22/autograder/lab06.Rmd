---
title: 'Lab 06: Introducing the Central Limit Theorem'
output: pdf_document
---


**Run this chunk of code to load the autograder package!**
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(testthat)
```

### Instructions 
* Due date: Tuesday, March 8th at 10:00pm PT with 2 hour grace period.
* Late penalty: 50% late penalty if submitted within 24 hours of due date, no marks for assignments submitted thereafter.
* This assignment is graded on **correct completion**, all or nothing. You must pass all public tests and submit the assignment for credit.
* Submission process: Follow the submission instructions on the final page. Make sure you do not remove any `\newpage` tags or rename this file, as this will break the submission.

Helpful hints:

- Every function you need to use was taught during lecture! So you may need to revisit the lecture code to help you along by opening the relevant files on Datahub. Alternatively, you may wish to view the code in the condensed PDFs posted on the course website. Good luck!

- Knit your file early and often to minimize knitting errors! If you copy and paste code for the slides, you are bound to get an error that is hard to diagnose. Typing out the code is the way to smooth knitting! We recommend knitting your file each time after you write a few sentences/add a new code chunk, so you can detect the source of knitting errors more easily. This will save you and the GSIs from frustration! **You must knit correctly before submitting.**

- If your code runs off the page of the knitted PDF then you will LOSE POINTS! To avoid this, have a look at your knitted PDF and ensure all the code fits in the file (you can easily view it on Gradescope via the provided link after submitting). If it doesn't look right, go back to your .Rmd file and add spaces (new lines) using the return or enter key so that the code runs onto the next line.

\newpage

--------------------------------------------------------------------------------


# (Optional) Relevant Textbook Exercises
The following questions in your textbook are helpful practice for 
understanding today's material:

Baldi and Moore: Ex. 13.5, 13.8, 13.9, 13. 10, 13.12, 13.14


# Introduction 

You will use a central data source (a Google sheet) attached to the lab to
develop a very concrete idea of sampling distributions, and to see the central 
limit theorem in action.  

# The underlying population

Suppose you had a data frame containing the **entire population** of all residents of Alameda County. You have data on three variables:

1.  Born either out (=1) versus in (=0) the county.
2.  Number of siblings (integer)
3.  Number of visits to the hospital last year

Read in the data, `L06_Alameda.csv` (it lives in the data folder) and assign it to the name `alameda_pop`. Calculate the true (population) mean, and make histograms or bar charts of the distribution for each variable.  

```{r readin, message = F, warning = F}
library(dplyr)
library(ggplot2)
library(readr)

#### YOUR CODE GOES HERE ####

# BEGIN SOLUTION NO PROMPT

# read in the data

alameda_pop <- read_csv("data/L06_Alameda.csv")
head(alameda_pop)

# compute the true population mean of each variable
alameda_pop %>% summarise_all(mean) # this code conducts all three summaries at 

# create a histogram or bar chart for each variable
alameda_pop %>%
  ggplot(aes(x = birth_loc)) +
    geom_histogram(binwidth = 1, colour = "black", fill = "blue") +
    scale_x_continuous(breaks = rep(0:1)) +
    theme_minimal()

alameda_pop %>%
  ggplot(aes(x = num_sibs)) +
    geom_histogram(binwidth = 1, colour = "black", fill = "blue") +
    scale_x_continuous(breaks = rep(0:10)) +
    theme_minimal()

alameda_pop %>%
  ggplot(aes(x = hosp_visit)) +
    geom_histogram(binwidth = 1, colour = "black", fill = "blue") +
    theme_minimal()

# END SOLUTION
```

Notice that the distribution of number of siblings and number of hospital visits are discrete distributions and both skewed right. Today, we will focus on the distribution of the number of siblings `num_sibs`. Remember that we know the population mean exactly because we have data from the entire population. You calculated the underlying population mean in the code chunk above.

### Calculating the sampling distribution

We are now going to look at the approximate **sampling distribution for the sample mean** of the `num_sibs` in (live) action. Remember from earlier lectures that a **sampling distribution** is a distribution for a statistic, like the sample proportion or the sample mean.

Each student will be tasked with repeatedly taking a random sample of the population. Once you take your sample you will compute the sample mean and add it to a shared google sheet. As the data is added to the google sheet, notice how the graph to the right of the data changes; this illustrate how the sampling distribution varies for increasingly larger sample sizes.

The links to the communal google sheets are below. The columns in the sheets are  `N (sample size)` and `mean(num_sibs)`.

### Your task

**1. Randomly generate 10 simple random samples of size $n=5$ from the population. Calculate the average number of siblings for each of your samples. We wrote code to start you off, which you can simply copy and paste 10 times to generate ten randomly drawn samples and their sample means.**

One sample has been provided to you. Try it yourself 10 times and record your results in the vector below.


# STOP! Remove eval = F before continuing on.
```{r size5, eval = F}
#### YOUR CODE GOES HERE ####

#repeat this code 10 times.
size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

# BEGIN SOLUTION NO PROMPT
size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

size_5 <- sample_n(alameda_pop, 5, replace = FALSE)
size_5 %>% summarise(mean_numSibs=mean(num_sibs))

# END SOLUTION
```

After you've calculated 10 sample means using the above code, copy and paste your data into the google sheet for your lab section. The links to all the google sheets are below:

- 101B (Thursday 2-4pm with Noel): https://docs.google.com/spreadsheets/d/18ymNh4D7Pkr-CcrslUnM-GptYJH5UahUhRGLxTdH6HA/edit#gid=0
- 102B (Friday 3-5pm with Jane): https://docs.google.com/spreadsheets/d/1f9xaduLFa2PNAKrVYFCOH0yCYfAv_SLrRApGPemZWtA/edit#gid=0
- 103B (Friday 4-6pm with Brian): https://docs.google.com/spreadsheets/d/1XmCn32cZWII85DlE9jED3LBiTpHUzptfdlrOXHAuaL0/edit#gid=0 
- 104B (Friday 10am-12pm with Chandler): https://docs.google.com/spreadsheets/d/1wo-N4LV8eO4iBv4_0A4h19mWKnH0wOB1iGWumRcqltA/edit#gid=0 
- 105B (Thursday 11am-1pm with Nolan): https://docs.google.com/spreadsheets/d/11o5pWnpbL3D1eoahkC3VM671sPj7fSp_ZGAg5lQ6kEU/edit#gid=0  
- 106B (Friday 12-2pm with Kelsey): https://docs.google.com/spreadsheets/d/1nhO_YuoaImZn5jJ4xlyow8CvvEaydXL3A_ruNMvLRi0/edit#gid=0 
- 107B (Friday 10am-12pm with Noel): https://docs.google.com/spreadsheets/d/10WCj3HUDaiyrT4VC-j5Ydm9a44MxJIBYtx4Ch_PHUFQ/edit#gid=0
- 108B (Friday 12-2pm with Siavash): https://docs.google.com/spreadsheets/d/1RH6lZRNdOZm1HIqstmTNJlY_YU046O4GIMIE16ZrSQQ/edit#gid=0  
- 109B (Wednesday 4-6pm with Antonia): https://docs.google.com/spreadsheets/d/1Bu9_THb6Sk09rWgPljYQRNObCtmZvnGeXPsj3FB4mlo/edit#gid=0
- 110B (Thursday 11am-1pm with Brian): https://docs.google.com/spreadsheets/d/13WSdsT7bdYhSvf3PSYMwTyISJV0wEin6OsI-ettKlfE/edit#gid=0 

Once the sheet is full, look at the plot of the **sampling distribution** for the mean number of siblings when $n=5$. 


- What is the range of the sampling distribution of the mean? 

<!-- BEGIN SOLUTION -->
0 to 4.24 (This will change for each class)
<!-- END SOLUTION -->


- What is the shape of the sampling distribution of the mean? 

<!-- BEGIN SOLUTION -->
skewed right 
<!-- END SOLUTION -->


- What is the mean of the sampling distribution of the mean? 

<!-- BEGIN SOLUTION -->
1.34 (This will change for each class)
<!-- END SOLUTION -->



Once the class has examined the sampling distribution when $n=5$, repeat the 
same steps for $n=50$. 


**2. Repeat the above process for a sample size of $n=50$.**

```{r size50}
#### YOUR CODE GOES HERE ####

# BEGIN SOLUTION NO PROMPT
size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))

size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))

size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))

size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))

size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))

size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))


size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))

size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))

size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))

size_50 <- sample_n(alameda_pop, 50, replace = FALSE)
size_50 %>% summarise(mean_numSibs=mean(num_sibs))

# END SOLUTION
```

After you calculate your 10 sample means, navigate to the google sheet, switch to the sheet with $n=50$, and add your data.

Look at the plot to the right on the google sheet and answer the following questions.

- What is the range of the sampling distribution of the mean? How does it compare to when $n=5$?

<!-- BEGIN SOLUTION -->
0.66 to 1.94 - a smaller interval than before. (This will change for each class)
<!-- END SOLUTION -->


- What is the shape of the sampling distribution of the mean? How does it compare to when $n=5$? 

<!-- BEGIN SOLUTION -->
Approximately normal, without much skew. This graph looks more normal than the distribution when $n=5$.
<!-- END SOLUTION -->


- What is the mean of the sampling distribution of the mean? 

<!-- BEGIN SOLUTION -->
1.23. Closer to the true value of 1.19. (This will change for each class)
<!-- END SOLUTION -->


**3. Repeat the entire process for sample size $n=500$.**

```{r size500}
#### YOUR CODE GOES HERE ####

# BEGIN SOLUTION NO PROMPT
size_500 <- sample_n(alameda_pop, 500, replace = FALSE)
size_500 %>% summarise(mean_numSibs=mean(num_sibs))

# END SOLUTION
```

- What is the range of the sampling distribution of the mean? How does it compare to when $n=5$ and $n=50$?

<!-- BEGIN SOLUTION -->
The range is of sample means should be between roughly 0.99 and 1.38. This range is much smaller than that of the distributions with sample sizes of $n=5$ and $n=50$. (This will change for each class)
<!-- END SOLUTION -->


- What is the shape of the sampling distribution of the mean? How does it compare
to when $n=5$ and $n=50$?

<!-- BEGIN SOLUTION -->
Approximately normal with small variance.
<!-- END SOLUTION -->


- What is the mean of the sampling distribution of the mean?

<!-- BEGIN SOLUTION -->
It should be even closer to the true value. We expect a more precise estimate as $n$ increases, but this does not always occur.
<!-- END SOLUTION -->


Suppose you have 500 classmates, and they have done this lab and added their data to this sheet: https://docs.google.com/spreadsheets/d/1AXStOd618raoWvrBequxOh5CDwgisFJoHo50fmcKb_E/edit?usp=sharing

Open the link, and look at the resulting sampling distributions for $n=5$, $n=50$, and $n=500$. This is what happens when you repeat the sampling 5,000 times.


**4. [1 point] Which of the following sampling distribution of the mean be most normal?**
  
  (a) $n=5$ 
  (b) $n=50$
  (c) $n=500$

Assign your letter choice as a string. For example: `sampleSize_answer <- "b"`.

```{r}
sampleSize_answer <- "REPLACE WITH a,b, or c. Keep the quotes"
sampleSize_answer

# BEGIN SOLUTION NO PROMPT
sampleSize_answer<- "c"
# END SOLUTION
```

```{r}
. = ottr::check("tests/p4.R")
```


### Part 2: Poisson Distribution

**5. How can you determine whether a random variable follows a Poisson distribution?**

<!-- BEGIN SOLUTION -->
1. Occurrences are all independent (that is, knowing that one event has
occurred does not change the probability that another event may occur- this
was also true for our binomial distribution).

2. The probability of an occurrence is the same over all possible intervals of the same size.
<!-- END SOLUTION -->


**Example from Baldi and Moore**

The state of New York reported 1484 live births between 2006 and 2010 in which the infants were born with Down syndrome. This averages to about 5.7 cases of Down Syndrome per week. While the causes of Down syndrome are not fully understood, it is reasonable to assume that live births are independent and the weekly rate is constant. Let X represent the count of babies born with Down syndrome in New York in a given week between 2006 and 2010.

**6. What distribution does the random variable X approximately follow? Use the notation learned in lecture. What are the possible values that X can take?**

<!-- BEGIN SOLUTION -->

X ~ Poisson(lambda = 5.7)
In theory, X can take any value greater than or equal to 0.

<!-- END SOLUTION -->


**7. [1 point] What are the mean and standard deviation of X?**

```{r}
. = " # BEGIN PROMPT
mean <- NULL # YOUR CODE HERE
sd <- NULL # YOUR CODE HERE
" # END PROMPT

# BEGIN SOLUTION NO PROMPT
mean <- 5.7
sd <- sqrt(5.7)
# END SOLUTION

mean
sd
```

```{r}
. = ottr::check("tests/p7.R")
```

**8. [1 point] What is the probability that no child will be born with Down syndrome in a given week in New York? Calculate the probability by hand and confirm your answer in R by assigning `p8` to a function that calculates this probability.**

```{r}
. = " # BEGIN PROMPT
p8 <- NULL # YOUR CODE HERE
p8
" # END PROMPT

# BEGIN SOLUTION NO PROMPT
p8 <- dpois(x = 0, lambda = 5.7)
p8
# END SOLUTION

```

```{r}
. = ottr::check("tests/p8.R")
```
<!-- BEGIN SOLUTION -->
P(X = 0) = {(e^-5.7)*5.7^0}/0! = 0.0033 = 0.3%
<!-- END SOLUTION -->

**9. [1 point] What is the probability that 2 or more children will be born with Down syndrome in a given week in New York? Calculate the probability by hand and confirm your answer in R by assigning `p9` to a function that calculates this probability.**

```{r}
. = " # BEGIN PROMPT
p9 <- NULL # YOUR CODE HERE
p9
" # END PROMPT

# BEGIN SOLUTION NO PROMPT
p9 <- 1 - ppois(q = 1, lambda = 5.7)
# alternate
p9 <- ppois(q = 1, lambda = 5.7, lower.tail = F)
# END SOLUTION

```

```{r}
. = ottr::check("tests/p9.R")
```
<!-- BEGIN SOLUTION -->
P(X >= 2) = 1 - P(X <= 1) = 1 - {(e^-5.7) * 5.7^0}/0! - {(e^-5.7) * 5.7^1}/1!
= 0.977582 = 97.76%
<!-- END SOLUTION -->


**10. [1 point] Use R to calculate the probability that more than 12 children are born with Down syndrome in a given week in New York.**

```{r}
. = " # BEGIN PROMPT
p10 <- NULL # YOUR CODE HERE
p10
" # END PROMPT

# BEGIN SOLUTION NO PROMPT
p10 <- ppois(q = 12, lambda = 5.7, lower.tail = F)

# alternate
p10 <- 1 - ppois(q = 12, lambda = 5.7)
# END SOLUTION

```

```{r}
. = ottr::check("tests/p10.R")
```
<!-- BEGIN SOLUTION NO PROMPT -->
P(X > 12) = 1 - P(X <= 12)
<!-- END SOLUTION -->

### Submission

For assignments in this class, you'll be submitting using the **Terminal** tab in the pane below. In order for the submission to work properly, make sure that:

1. Any image files you add that are needed to knit the file are in the `src` folder and file paths are specified accordingly.
2. You **have not changed the file name** of the assignment.
3. The file knits properly.

Once you have checked these items, you can proceed to submit your assignment.

1. Click on the **Terminal** tab in the pane below.
2. Copy-paste the following line of code into the terminal and press enter.

cd; cd ph142-sp22/lab/lab06; python3 turn_in.py

3. Follow the prompts to enter your Gradescope username and password.
4. If the submission is successful, you should see "Submission successful!" appear as the output. **Check your submission on the Gradescope website to ensure that the autograder worked properly and you received credit for your correct answers. If you think the autograder is incorrectly grading your work, please post on piazza!**
5. If the submission fails, try to diagnose the issue using the error messages--if you have problems, post on Piazza under the post "Datahub Issues".

The late policy will be strictly enforced, **no matter the reason**, including submission issues, so be sure to submit early enough to have time to diagnose issues if problems arise.
